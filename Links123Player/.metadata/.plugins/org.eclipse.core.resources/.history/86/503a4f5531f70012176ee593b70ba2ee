<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx" backgroundColor="0x000000" minWidth="955" minHeight="600" creationComplete="init()">
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import flash.filters.GlowFilter;
			import flash.filters.BitmapFilterQuality;
			private var urlrequest:URLRequest;
			private var mysound:Sound;
			private var sourceSnd:Sound;
			private var mp3player:Mp3Player;
			
			private var sounchannel:SoundChannel;
			private var time:Timer = new Timer(500);
			
			private var byte:ByteArray = new ByteArray(); //音频谱
			private var num:Number=0;
			private var t:Number = 0; 
			
			private var bx:Sprite=new Sprite();  
			private function init():void
			{
				Security.allowDomain("*");
				Security.allowInsecureDomain("*");//links123/audio.mp3
				urlrequest = new URLRequest("http://127.0.0.1/links123/audio.mp3");
				
				mysound = new Sound();
				mysound.load(urlrequest);
				mysound.addEventListener(Event.COMPLETE,loadComplete);
				
//				time.addEventListener(TimerEvent.TIMER,timerhandel);
//				time.start();
				
				this.addEventListener(Event.ENTER_FRAME,enterframe);
//慢放功能	(待定)
//				mp3player = new Mp3Player();
//				mp3player.playbackSpeed=0.9;
//				mp3player.loadAndPlay(urlrequest);

				con.addChild(bx);
			}
			
			protected function loadComplete(event:Event):void
			{	
//				从多少秒播放到多少秒停止(单位毫秒)
				sounchannel = mysound.play(10000);
			 }
			
			protected function timerhandel(event:TimerEvent):void
			{
				if(sounchannel!=null && mysound!=null)
				{
					trace("总长度:"+mysound.length+",当前位置:"+sounchannel.position);
					if(sounchannel.position>=15000)
					{
						sounchannel.stop();
						time.removeEventListener(TimerEvent.TIMER,timerhandel);
						trace("声音已停止");
					}
				}
			}
			
			private var n:Number=10;  
			protected function enterframe(event:Event):void
			{
//				SoundMixer.computeSpectrum(byte,true,0);
//				num = byte.readFloat()*10;
				bx.graphics.clear();  
				SoundMixer.computeSpectrum(byte,true,1);//将当前声音输出为ByteArray  
				for (var i:int=0; i <1000; i=i+5) {  
					n = byte.readFloat()*60;//把数据流读取成浮点数并扩大其值  
					bx.graphics.lineStyle(3,0xFFFFFF,1,true,"noSacle","none");  
					bx.graphics.moveTo(27+i,50);  
					bx.graphics.lineTo(27+i,50-n)  
					bx.graphics.lineStyle(3,0xFFFFFF,0.2,true,"noSacle","none");  
					bx.graphics.lineTo(27+i,50+n);  
				}
				var glow:GlowFilter = new GlowFilter(); 
				glow.color = 0x009922;
				glow.alpha = 1; 
				glow.blurX = 25; 
				glow.blurY = 25; 
				glow.quality = BitmapFilterQuality.MEDIUM;
				bx.filters = [glow];
			}
			
		]]>
	</fx:Script>
	<mx:UIComponent width="100%" height="100" id="con" verticalCenter="0" horizontalCenter="0">
	</mx:UIComponent>
</s:Application>
